<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ts 常量断言 | Sunflower</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/img/sunshine.jpeg">
    <meta name="description" content="偶尔更新doc">
    <link rel="preload" href="/assets/css/0.styles.ccac5a78.css" as="style"><link rel="preload" href="/assets/js/app.67a06e2a.js" as="script"><link rel="preload" href="/assets/js/2.7ed6e0fd.js" as="script"><link rel="preload" href="/assets/js/34.14972397.js" as="script"><link rel="prefetch" href="/assets/js/10.ee467621.js"><link rel="prefetch" href="/assets/js/11.cca2397f.js"><link rel="prefetch" href="/assets/js/12.48cbfdce.js"><link rel="prefetch" href="/assets/js/13.9194c880.js"><link rel="prefetch" href="/assets/js/14.5c7db278.js"><link rel="prefetch" href="/assets/js/15.578f357d.js"><link rel="prefetch" href="/assets/js/16.25ab4d6d.js"><link rel="prefetch" href="/assets/js/17.08a8d0a6.js"><link rel="prefetch" href="/assets/js/18.c0daf5fc.js"><link rel="prefetch" href="/assets/js/19.3637b3ef.js"><link rel="prefetch" href="/assets/js/20.b97aa59a.js"><link rel="prefetch" href="/assets/js/21.a3dfa066.js"><link rel="prefetch" href="/assets/js/22.57c83861.js"><link rel="prefetch" href="/assets/js/23.18548b14.js"><link rel="prefetch" href="/assets/js/24.c5d11d97.js"><link rel="prefetch" href="/assets/js/25.b36af2e2.js"><link rel="prefetch" href="/assets/js/26.268b6250.js"><link rel="prefetch" href="/assets/js/27.7ccfcfbc.js"><link rel="prefetch" href="/assets/js/28.582a2eab.js"><link rel="prefetch" href="/assets/js/29.f8337309.js"><link rel="prefetch" href="/assets/js/3.dd930c85.js"><link rel="prefetch" href="/assets/js/30.08ce907b.js"><link rel="prefetch" href="/assets/js/31.cd8090b9.js"><link rel="prefetch" href="/assets/js/32.13940ddb.js"><link rel="prefetch" href="/assets/js/33.20b9e539.js"><link rel="prefetch" href="/assets/js/35.30d59af0.js"><link rel="prefetch" href="/assets/js/36.789009da.js"><link rel="prefetch" href="/assets/js/37.5a731b3e.js"><link rel="prefetch" href="/assets/js/38.98854451.js"><link rel="prefetch" href="/assets/js/39.55959422.js"><link rel="prefetch" href="/assets/js/4.79e3ce3d.js"><link rel="prefetch" href="/assets/js/5.257dc403.js"><link rel="prefetch" href="/assets/js/6.10f1c89c.js"><link rel="prefetch" href="/assets/js/7.b630b188.js"><link rel="prefetch" href="/assets/js/8.2ae4ec6c.js"><link rel="prefetch" href="/assets/js/9.0ab8a1bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccac5a78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Sunflower</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sunshine/" class="nav-link">
  sunshine
</a></div><div class="nav-item"><a href="/plugin/" class="nav-link">
  插件
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试" class="mobile-dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interView/58/" class="nav-link">
  58
</a></li><li class="dropdown-item"><!----> <a href="/interView/other/" class="nav-link">
  other
</a></li><li class="dropdown-item"><!----> <a href="/interView/view/" class="nav-link">
  view
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/index/" class="nav-link">
  Js方法/思路
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts/" class="nav-link">
  TS-骚操作写法
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts_demo/" class="nav-link">
  TS-使用用例
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts_const/" class="nav-link">
  TS-常量断言（语法写作 as const）
</a></li><li class="dropdown-item"><!----> <a href="/learn/version/" class="nav-link">
  开发中产品的各版本定义(beta,alpha,rc,release)
</a></li><li class="dropdown-item"><!----> <a href="/learn/remove_commit/" class="nav-link">
  git 删除历史 commit
</a></li><li class="dropdown-item"><!----> <a href="/learn/rollup/" class="nav-link">
  rollup&amp;js/ts sdk
</a></li><li class="dropdown-item"><!----> <a href="/learn/tree/" class="nav-link">
  在 README.md 中生成项目目录结构
</a></li><li class="dropdown-item"><!----> <a href="/learn/git/" class="nav-link">
  Git commit message 规范
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="es6(ryf)" class="dropdown-title"><span class="title">es6(ryf)</span> <span class="arrow down"></span></button> <button type="button" aria-label="es6(ryf)" class="mobile-dropdown-title"><span class="title">es6(ryf)</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6/array/" class="nav-link">
  array
</a></li><li class="dropdown-item"><!----> <a href="/es6/let_const/" class="nav-link">
  let_const
</a></li><li class="dropdown-item"><!----> <a href="/es6/class/" class="nav-link">
  class
</a></li><li class="dropdown-item"><!----> <a href="/es6/class_extends/" class="nav-link">
  class_extends
</a></li><li class="dropdown-item"><!----> <a href="/es6/function/" class="nav-link">
  function
</a></li><li class="dropdown-item"><!----> <a href="/es6/module/" class="nav-link">
  module
</a></li><li class="dropdown-item"><!----> <a href="/es6/number/" class="nav-link">
  number
</a></li><li class="dropdown-item"><!----> <a href="/es6/object/" class="nav-link">
  object
</a></li><li class="dropdown-item"><!----> <a href="/es6/object_methonds/" class="nav-link">
  object_methonds
</a></li><li class="dropdown-item"><!----> <a href="/es6/set_map/" class="nav-link">
  set_map
</a></li><li class="dropdown-item"><!----> <a href="/es6/async/" class="nav-link">
  async
</a></li><li class="dropdown-item"><!----> <a href="/es6/string/" class="nav-link">
  string
</a></li><li class="dropdown-item"><!----> <a href="/es6/string_methonds/" class="nav-link">
  string_methonds
</a></li><li class="dropdown-item"><!----> <a href="/es6/symbol/" class="nav-link">
  symbol
</a></li><li class="dropdown-item"><!----> <a href="/es6/iterator/" class="nav-link">
  遍历器
</a></li><li class="dropdown-item"><!----> <a href="/es6/proxy/" class="nav-link">
  proxy
</a></li><li class="dropdown-item"><!----> <a href="/es6/promise/" class="nav-link">
  promise
</a></li><li class="dropdown-item"><!----> <a href="/es6/generator/" class="nav-link">
  generator
</a></li><li class="dropdown-item"><!----> <a href="/es6/style/" class="nav-link">
  编程风格
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MemoSanMu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/sunshine/" class="nav-link">
  sunshine
</a></div><div class="nav-item"><a href="/plugin/" class="nav-link">
  插件
</a></div><div class="nav-item"><a href="/react/" class="nav-link">
  React
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试" class="mobile-dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interView/58/" class="nav-link">
  58
</a></li><li class="dropdown-item"><!----> <a href="/interView/other/" class="nav-link">
  other
</a></li><li class="dropdown-item"><!----> <a href="/interView/view/" class="nav-link">
  view
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><span class="title">学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="学习" class="mobile-dropdown-title"><span class="title">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/learn/index/" class="nav-link">
  Js方法/思路
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts/" class="nav-link">
  TS-骚操作写法
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts_demo/" class="nav-link">
  TS-使用用例
</a></li><li class="dropdown-item"><!----> <a href="/learn/ts_const/" class="nav-link">
  TS-常量断言（语法写作 as const）
</a></li><li class="dropdown-item"><!----> <a href="/learn/version/" class="nav-link">
  开发中产品的各版本定义(beta,alpha,rc,release)
</a></li><li class="dropdown-item"><!----> <a href="/learn/remove_commit/" class="nav-link">
  git 删除历史 commit
</a></li><li class="dropdown-item"><!----> <a href="/learn/rollup/" class="nav-link">
  rollup&amp;js/ts sdk
</a></li><li class="dropdown-item"><!----> <a href="/learn/tree/" class="nav-link">
  在 README.md 中生成项目目录结构
</a></li><li class="dropdown-item"><!----> <a href="/learn/git/" class="nav-link">
  Git commit message 规范
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="es6(ryf)" class="dropdown-title"><span class="title">es6(ryf)</span> <span class="arrow down"></span></button> <button type="button" aria-label="es6(ryf)" class="mobile-dropdown-title"><span class="title">es6(ryf)</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6/array/" class="nav-link">
  array
</a></li><li class="dropdown-item"><!----> <a href="/es6/let_const/" class="nav-link">
  let_const
</a></li><li class="dropdown-item"><!----> <a href="/es6/class/" class="nav-link">
  class
</a></li><li class="dropdown-item"><!----> <a href="/es6/class_extends/" class="nav-link">
  class_extends
</a></li><li class="dropdown-item"><!----> <a href="/es6/function/" class="nav-link">
  function
</a></li><li class="dropdown-item"><!----> <a href="/es6/module/" class="nav-link">
  module
</a></li><li class="dropdown-item"><!----> <a href="/es6/number/" class="nav-link">
  number
</a></li><li class="dropdown-item"><!----> <a href="/es6/object/" class="nav-link">
  object
</a></li><li class="dropdown-item"><!----> <a href="/es6/object_methonds/" class="nav-link">
  object_methonds
</a></li><li class="dropdown-item"><!----> <a href="/es6/set_map/" class="nav-link">
  set_map
</a></li><li class="dropdown-item"><!----> <a href="/es6/async/" class="nav-link">
  async
</a></li><li class="dropdown-item"><!----> <a href="/es6/string/" class="nav-link">
  string
</a></li><li class="dropdown-item"><!----> <a href="/es6/string_methonds/" class="nav-link">
  string_methonds
</a></li><li class="dropdown-item"><!----> <a href="/es6/symbol/" class="nav-link">
  symbol
</a></li><li class="dropdown-item"><!----> <a href="/es6/iterator/" class="nav-link">
  遍历器
</a></li><li class="dropdown-item"><!----> <a href="/es6/proxy/" class="nav-link">
  proxy
</a></li><li class="dropdown-item"><!----> <a href="/es6/promise/" class="nav-link">
  promise
</a></li><li class="dropdown-item"><!----> <a href="/es6/generator/" class="nav-link">
  generator
</a></li><li class="dropdown-item"><!----> <a href="/es6/style/" class="nav-link">
  编程风格
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/MemoSanMu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ts 常量断言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn/ts_const.html#ts-常量断言" class="sidebar-link">ts 常量断言</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn/ts_const.html#ts-中的常量断言" class="sidebar-link">TS 中的常量断言</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#此时我们会发现上面-hook-的返回值的类型被推导成了如下的数组类型" class="sidebar-link">此时我们会发现上面 Hook 的返回值的类型被推导成了如下的数组类型：</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#上面的-value-和-setvalue-都被推导成了-number-nextstate-number-number-的联合类型。" class="sidebar-link">上面的 value 和 setValue 都被推导成了 number | (nextState: number) =&gt; number 的联合类型。</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#在-3-4-以前的-ts-中-我们只能通过对输出值的声明或者断言来明确-hooks-的返回值类型是元组-tuple-而不是数组-array" class="sidebar-link">在 3.4 以前的 TS 中，我们只能通过对输出值的声明或者断言来明确 Hooks 的返回值类型是元组（Tuple）而不是数组（Array）：</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#as-const" class="sidebar-link">as const</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#上面的两种写法都各有冗余成分-算不上优雅。" class="sidebar-link">上面的两种写法都各有冗余成分，算不上优雅。</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#其实从语义层面来分析-ts-之所以没能将返回值推断为元组类型是因为它认为该返回值仍有可能被-push-值-被修改。所以我们真正需要做的是告诉-ts-这个返回值是一个-final-其本身和属性都是不可篡改的-而这正是常量断言所做的事" class="sidebar-link">其实从语义层面来分析，TS 之所以没能将返回值推断为元组类型是因为它认为该返回值仍有可能被 push 值，被修改。所以我们真正需要做的是告诉 TS，这个返回值是一个 final，其本身和属性都是不可篡改的，而这正是常量断言所做的事</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#常量断言可以把一个值标记为一个不可篡改的常量-从而让-ts-以最严格的策略来进行类型推断" class="sidebar-link">常量断言可以把一个值标记为一个不可篡改的常量，从而让 TS 以最严格的策略来进行类型推断：</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#无论是语法层面还是语义层面都准确而无冗余-可以说是最佳实践了。" class="sidebar-link">无论是语法层面还是语义层面都准确而无冗余，可以说是最佳实践了。</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#两个-const-的区别" class="sidebar-link">两个 const 的区别</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#例如下面字面量对象的第二层属性仍被推断成了-1967-这样的单值类型而不是宽泛的-number-类型-其类型推断结果与字面量声明几乎长得一模一样。" class="sidebar-link">例如下面字面量对象的第二层属性仍被推断成了 1967 这样的单值类型而不是宽泛的 number 类型，其类型推断结果与字面量声明几乎长得一模一样。</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#所以笔者认为其实-as-const-写作-as-readonly-或-as-final-更能准确反映它的语义和行为" class="sidebar-link">所以笔者认为其实 as const 写作 as readonly 或 as final 更能准确反映它的语义和行为</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#用作枚举" class="sidebar-link">用作枚举</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#常量断言可以让我们不需要-enum-关键字就能定义枚举对象" class="sidebar-link">** 常量断言可以让我们不需要 enum 关键字就能定义枚举对象：</a></li><li class="sidebar-sub-header"><a href="/learn/ts_const.html#在使用该枚举对象时我们需要先实现一个-valueof-工具范型来帮助我们获取得到所谓的「枚举类型」" class="sidebar-link">在使用该枚举对象时我们需要先实现一个 ValueOf 工具范型来帮助我们获取得到所谓的「枚举类型」：</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="ts-常量断言"><a href="#ts-常量断言" class="header-anchor">#</a> ts 常量断言</h2> <h3 id="ts-中的常量断言"><a href="#ts-中的常量断言" class="header-anchor">#</a> <code>TS 中的常量断言</code></h3> <blockquote><p>常量断言（语法写作 as const）是 TypeScript 3.4 （现在的最新版本是 3.8.3）发布的新特性中最实用的一个，TS 会区别对待可修改和不可修改的值的类型推断：</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code>例如下面的 immutableString 会被推断成单值类型 <span class="token string">'Acid Mother Temple'</span>

而 mutableString 则会被推断成通用的 <span class="token builtin">string</span> 类型

<span class="token keyword">const</span> immutableString <span class="token operator">=</span> <span class="token string">'Acid Mother Temple'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mutableString <span class="token operator">=</span> <span class="token string">'Robert Fripp'</span><span class="token punctuation">;</span>
而在一般的对象中，由于对象的属性都具有可修改性，<span class="token constant">TS</span> 都会对它们「从宽」类型推断，例如下面的 prop 的类型被推断为 <span class="token builtin">string</span>：

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  prop<span class="token operator">:</span> <span class="token string">'David Bowie'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h4> <blockquote><p>这样的类型推断策略在大部分的情形下比较通用，但在个别情形下会显得有些棘手。例如我们想实现一个 React 中的自定义 Hook。这个 Hook 能通过 Ref 维护一个状态。它的返回值与 useState 类似是一个元组：第一项是该状态的值，第二项是该状态的 setter</p></blockquote> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> useRenderlessState <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> stateRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> state <span class="token operator">=</span> stateRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token punctuation">(</span>nextState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>stateRef<span class="token punctuation">.</span>current <span class="token operator">=</span> nextState<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="此时我们会发现上面-hook-的返回值的类型被推导成了如下的数组类型"><a href="#此时我们会发现上面-hook-的返回值的类型被推导成了如下的数组类型" class="header-anchor">#</a> 此时我们会发现上面 Hook 的返回值的类型被推导成了如下的数组类型：</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token punctuation">(</span><span class="token constant">S</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>nextState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">S</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
这让我们无法对它进行准确的解构：

<span class="token comment">// 组件中使用</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useRenderlessState</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="上面的-value-和-setvalue-都被推导成了-number-nextstate-number-number-的联合类型。"><a href="#上面的-value-和-setvalue-都被推导成了-number-nextstate-number-number-的联合类型。" class="header-anchor">#</a> 上面的 value 和 setValue 都被推导成了 number | (nextState: number) =&gt; number 的联合类型。</h3> <h3 id="在-3-4-以前的-ts-中-我们只能通过对输出值的声明或者断言来明确-hooks-的返回值类型是元组-tuple-而不是数组-array"><a href="#在-3-4-以前的-ts-中-我们只能通过对输出值的声明或者断言来明确-hooks-的返回值类型是元组-tuple-而不是数组-array" class="header-anchor">#</a> 在 3.4 以前的 TS 中，我们只能通过对输出值的声明或者断言来明确 Hooks 的返回值类型是元组（Tuple）而不是数组（Array）：</h3> <div class="language-ts extra-class"><pre class="language-ts"><code>声明的做法<span class="token punctuation">;</span>
<span class="token keyword">const</span> useRenderlessState <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>nextValue<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">S</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token regex">/_..._/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

断言的做法<span class="token punctuation">;</span>
<span class="token keyword">const</span> useRenderlessState <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token punctuation">[</span><span class="token keyword">typeof</span> value<span class="token punctuation">,</span> <span class="token keyword">typeof</span> setValue<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="as-const"><a href="#as-const" class="header-anchor">#</a> as const</h3> <h3 id="上面的两种写法都各有冗余成分-算不上优雅。"><a href="#上面的两种写法都各有冗余成分-算不上优雅。" class="header-anchor">#</a> 上面的两种写法都各有冗余成分，算不上优雅。</h3> <h3 id="其实从语义层面来分析-ts-之所以没能将返回值推断为元组类型是因为它认为该返回值仍有可能被-push-值-被修改。所以我们真正需要做的是告诉-ts-这个返回值是一个-final-其本身和属性都是不可篡改的-而这正是常量断言所做的事"><a href="#其实从语义层面来分析-ts-之所以没能将返回值推断为元组类型是因为它认为该返回值仍有可能被-push-值-被修改。所以我们真正需要做的是告诉-ts-这个返回值是一个-final-其本身和属性都是不可篡改的-而这正是常量断言所做的事" class="header-anchor">#</a> 其实从语义层面来分析，TS 之所以没能将返回值推断为元组类型是因为它认为该返回值仍有可能被 push 值，被修改。所以我们真正需要做的是告诉 TS，这个返回值是一个 final，其本身和属性都是不可篡改的，而这正是常量断言所做的事</h3> <h3 id="常量断言可以把一个值标记为一个不可篡改的常量-从而让-ts-以最严格的策略来进行类型推断"><a href="#常量断言可以把一个值标记为一个不可篡改的常量-从而让-ts-以最严格的策略来进行类型推断" class="header-anchor">#</a> 常量断言可以把一个值标记为一个不可篡改的常量，从而让 TS 以最严格的策略来进行类型推断：</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> useRenderlessState <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>initialState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span>
<span class="token punctuation">}</span>

这下 useRenderlessState 的返回类型就被推断成了如下的 <span class="token keyword">readonly</span> 值：

<span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>nextState<span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">S</span><span class="token punctuation">]</span>

</code></pre></div><h3 id="无论是语法层面还是语义层面都准确而无冗余-可以说是最佳实践了。"><a href="#无论是语法层面还是语义层面都准确而无冗余-可以说是最佳实践了。" class="header-anchor">#</a> 无论是语法层面还是语义层面都准确而无冗余，可以说是最佳实践了。</h3> <h3 id="两个-const-的区别"><a href="#两个-const-的区别" class="header-anchor">#</a> 两个 const 的区别</h3> <blockquote><p>as const 中的 const 与我们声明常量时使用的 const 有什么区别和联系呢？其实两者无论是语法还是语义，都相当不同：</p></blockquote> <blockquote><p>const 常量声明是 ES6 的语法，对 TS 而言，它只能反映该常量本身是不可被重新赋值的，它的子属性仍然可以被修改，故 TS 只会对它们做松散的类型推断
as const 是 TS 的语法，它告诉 TS 它所断言的值以及该值的所有层级的子属性都是不可篡改的，故对每一级子属性都会做最严格的类型推断</p></blockquote> <h3 id="例如下面字面量对象的第二层属性仍被推断成了-1967-这样的单值类型而不是宽泛的-number-类型-其类型推断结果与字面量声明几乎长得一模一样。"><a href="#例如下面字面量对象的第二层属性仍被推断成了-1967-这样的单值类型而不是宽泛的-number-类型-其类型推断结果与字面量声明几乎长得一模一样。" class="header-anchor">#</a> 例如下面字面量对象的第二层属性仍被推断成了 1967 这样的单值类型而不是宽泛的 number 类型，其类型推断结果与字面量声明几乎长得一模一样。</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> albumsByStyle <span class="token operator">=</span> <span class="token punctuation">{</span>
  psychodelic<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'magical-mystery-tour'</span><span class="token operator">:</span> <span class="token number">1967</span><span class="token punctuation">,</span>
    <span class="token string">'the-piper-at-the-gates-of-dawn'</span><span class="token operator">:</span> <span class="token number">1967</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  glam<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'a-night-at-the-opera'</span><span class="token operator">:</span> <span class="token number">1975</span><span class="token punctuation">,</span>
    <span class="token string">'diamond-dogs'</span><span class="token operator">:</span> <span class="token number">1974</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="所以笔者认为其实-as-const-写作-as-readonly-或-as-final-更能准确反映它的语义和行为"><a href="#所以笔者认为其实-as-const-写作-as-readonly-或-as-final-更能准确反映它的语义和行为" class="header-anchor">#</a> 所以笔者认为其实 as const 写作 as readonly 或 as final 更能准确反映它的语义和行为</h3> <h3 id="用作枚举"><a href="#用作枚举" class="header-anchor">#</a> 用作枚举</h3> <h3 id="常量断言可以让我们不需要-enum-关键字就能定义枚举对象"><a href="#常量断言可以让我们不需要-enum-关键字就能定义枚举对象" class="header-anchor">#</a> ** 常量断言可以让我们不需要 enum 关键字就能定义枚举对象：</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> EnvEnum <span class="token operator">=</span> <span class="token punctuation">{</span>
  Development<span class="token operator">:</span> <span class="token string">'dev'</span><span class="token punctuation">,</span>
  Production<span class="token operator">:</span> <span class="token string">'prod'</span><span class="token punctuation">,</span>
  Testing<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="在使用该枚举对象时我们需要先实现一个-valueof-工具范型来帮助我们获取得到所谓的「枚举类型」"><a href="#在使用该枚举对象时我们需要先实现一个-valueof-工具范型来帮助我们获取得到所谓的「枚举类型」" class="header-anchor">#</a> 在使用该枚举对象时我们需要先实现一个 ValueOf 工具范型来帮助我们获取得到所谓的「枚举类型」：</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ValueOf<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">EnvEnumType</span> <span class="token operator">=</span> ValueOf<span class="token operator">&lt;</span><span class="token keyword">typeof</span> EnvEnum<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> env<span class="token operator">:</span> EnvEnumType <span class="token operator">=</span> EnvEnum<span class="token punctuation">.</span>Development<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>上面的用法可能显得脱裤子放屁，不过也算是常量断言的一种巧用，而且他带来了比使用 enum 更多的可能性</p></blockquote> <blockquote><p>以上就是常量断言的相关内容，它可以帮我们把 TS 代码写的更准确简洁。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.67a06e2a.js" defer></script><script src="/assets/js/2.7ed6e0fd.js" defer></script><script src="/assets/js/34.14972397.js" defer></script>
  </body>
</html>
